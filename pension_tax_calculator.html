<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מחשבון הטבות מס לחיסכון פנסיוני 2025</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-right: 4px solid #667eea;
        }

        .section-title {
            font-size: 20px;
            color: #667eea;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="file"] {
            display: none;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-upload {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .upload-status {
            text-align: center;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
        }

        .upload-status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }

        .upload-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }

        .results {
            display: none;
            margin-top: 30px;
        }

        .result-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .result-box.highlight {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-color: #667eea;
        }

        .result-title {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 15px;
        }

        .result-item {
            padding: 10px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-label {
            font-weight: 600;
            color: #555;
        }

        .result-value {
            font-weight: bold;
            color: #333;
            font-size: 18px;
        }

        .result-value.success {
            color: #28a745;
        }

        .result-value.danger {
            color: #dc3545;
        }

        .explanation {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .explanation-title {
            font-weight: bold;
            color: #856404;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .explanation-text {
            color: #856404;
            line-height: 1.6;
            font-size: 14px;
        }

        .icon {
            display: inline-block;
            margin-left: 8px;
        }

        .big-number {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 10px;
            margin: 20px 0;
        }

        .info-box {
            background: #e7f3ff;
            border: 1px solid #2196F3;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .info-box-title {
            font-weight: bold;
            color: #1565C0;
            margin-bottom: 8px;
        }

        .info-box-text {
            color: #1565C0;
            line-height: 1.6;
            font-size: 14px;
        }

        .warning-box {
            background: #fff3e0;
            border: 1px solid #ff9800;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .warning-title {
            font-weight: bold;
            color: #e65100;
            margin-bottom: 8px;
        }

        .warning-text {
            color: #e65100;
            line-height: 1.6;
            font-size: 14px;
        }

        .step {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-right: 3px solid #667eea;
        }

        .step-number {
            display: inline-block;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧮 מחשבון הטבות מס לחיסכון פנסיוני</h1>
            <p>שנת מס 2025 | חישוב מדויק לפי פקודת מס הכנסה</p>
        </div>

        <div class="content">
            <div class="info-box">
                <div class="info-box-title">💡 למה המחשבון הזה?</div>
                <div class="info-box-text">
                    מחשבון זה עוזר לך לחשב את ההטבות המקסימליות במס שאת/ה זכאי/ת להן בגין הפקדות עצמאיות לחיסכון פנסיוני. המחשבון מתאים לשכירים עם שכר לא מבוטח (בונוסים, דמי הבראה, נסיעות וכו').
                </div>
            </div>

            <div class="section">
                <div class="section-title">📝 הזנת נתונים</div>
                
                <!-- כפתור טעינת ניתוח מס -->
                <input type="file" id="htmlFileInput" accept=".html,.htm" style="display: none;">
                <button class="btn btn-upload" onclick="document.getElementById('htmlFileInput').click()">
                    📄 טען ניתוח מס
                </button>
                <div id="uploadStatus" class="upload-status"></div>
                
                <div class="input-group">
                    <label>שכר ברוטו מבוטח (שנתי) ₪</label>
                    <input type="number" id="shacharMevutach" placeholder="לדוגמה: 700000">
                </div>

                <div class="input-group">
                    <label>שכר ברוטו לא מבוטח (שנתי) ₪</label>
                    <input type="number" id="shacharLoMevutach" placeholder="לדוגמה: 109407">
                </div>

                <div class="input-group">
                    <label>מספר חודשי עבודה בשנה</label>
                    <input type="number" id="months" value="12" min="1" max="12">
                </div>

                <div class="input-group">
                    <label>הפקדות קיימות לפנסיה (שנתי) ₪</label>
                    <input type="number" id="havkadotPensia" placeholder="לדוגמה: 16122">
                </div>
                <div class="input-group">
                    <label>הפקדות קיימות לביטוח חיים (שנתי) ₪</label>
                    <input type="number" id="bituachChayim" placeholder="לדוגמה: 398">
                </div>

                <div class="input-group">
                    <label>גיל</label>
                    <input type="number" id="age" placeholder="לדוגמה: 52" min="18" max="120">
                </div>
                 <div class="input-group">
                    <label>שכר לא מעבודה  (שנתי) ₪</label>
                    <input type="number" id="shacharLoMeAvoda" placeholder="לדוגמה: 100000">
                </div>

                <button class="btn" onclick="calculate()">🔍 חשב הטבות מס</button>
            </div>

            <div id="results" class="results"></div>
        </div>
    </div>

    <script>
        // ============= פונקציות טעינת HTML =============

document.getElementById('htmlFileInput').addEventListener('change', async function(e) {
    const file = e.target.files[0];
    if (!file) return;
    
    const statusDiv = document.getElementById('uploadStatus');
    
    try {
        // קריאת הקובץ עם קידוד windows-1255
        const arrayBuffer = await file.arrayBuffer();
        const decoder = new TextDecoder('windows-1255');
        const htmlContent = decoder.decode(arrayBuffer);
        
        const extractedData = parseHtmlFile(htmlContent);
        
        if (extractedData.success) {
            fillFormFields(extractedData);
            statusDiv.className = 'upload-status success';
            statusDiv.textContent = '✅ הנתונים נטענו בהצלחה! אנא בדוק ועדכן את הגיל.';
        } else {
            statusDiv.className = 'upload-status error';
            statusDiv.textContent = '❌ שגיאה: ' + extractedData.error;
        }
    } catch (error) {
        statusDiv.className = 'upload-status error';
        statusDiv.textContent = '❌ שגיאה בקריאת הקובץ: ' + error.message;
    }
});

        function parseHtmlFile(htmlContent) {
    try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        
        const result = {
            success: false,
            shacharMevutach: 0,
            shacharLoMevutach: 0,
            months: 0,
            havkadotPensia: 0,
            bituachChayim: 0,
            error: ''
        };

        console.log('=== התחלת ניתוח הקובץ ===');
       

// 1. חישוב מספר חודשים מטבלת "יחידות מס"
const yehidotMasTable = findTableByPartialTitle(doc, 'h1', ['יחידות מס']);

if (yehidotMasTable) {
    console.log('✅ נמצאה טבלת יחידות מס');
    
    const allRows = yehidotMasTable.querySelectorAll('tr');
    
    // קח את השורה השנייה (אינדקס 1) - שם יחידות המס!
    if (allRows.length >= 2) {
        const dataRow = allRows[1]; // שורה 1 במקום שורה 0
        const cells = dataRow.querySelectorAll('td, th');
        let monthCount = 0;
        
        console.log('=== ספירת חודשים מהשורה השנייה ===');
        
        for (let i = 0; i < cells.length; i++) {
            const cellText = cells[i].textContent.trim();
            const value = parseFloat(cellText);
            
            console.log(`בודק תא ${i}: "${cellText}" → מספר: ${value}`);
            
            if (!isNaN(value) && value > 0 && value <= 31) {
                monthCount++;
                console.log(`  ✓ זה יחידת מס! סה"כ: ${monthCount}`);
            } else {
                console.log(`  ✗ לא יחידת מס - עוצר`);
                break;
            }
        }
        
        if (monthCount > 0 && monthCount <= 12) {
            result.months = monthCount;
            console.log('✅ מספר חודשים סופי:', monthCount);
        }
    }
} else {
    console.log('❌ לא נמצאה טבלת יחידות מס');
}


// 2. חילוץ שכר מבוטח - רק מטבלת "נתוני עזר לחישוב ההטבות"
console.log('מחפש טבלת נתוני עזר...');
const natuneyEzerTable = findTableAfterH3(doc, 'נתוני  עזר לחישוב ההטבות');

if (natuneyEzerTable) {
    console.log('✅ נמצאה טבלת נתוני עזר');
    const rows = natuneyEzerTable.querySelectorAll('tr');
    
    rows.forEach((row, rowIndex) => {
        const cells = row.querySelectorAll('th, td');
        
        cells.forEach((cell, cellIndex) => {
            const cellText = cell.textContent.trim();
            
            // שכר לא מבוטח פנסיונית
            if (cellText.includes('הכנסת עבודה לא') && cellText.includes('מבוטחת פנסיונית')) {
                const nextRow = rows[rowIndex + 1];
                if (nextRow) {
                    const nextCells = nextRow.querySelectorAll('th, td');
                    if (nextCells[cellIndex]) {
                        const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                        if (!isNaN(value) && value > 0) {
                            result.shacharLoMevutach = value;
                            console.log('✅ שכר לא מבוטח:', value);
                        }
                    }
                }
            }
             // שכר לא מעבודה
            if (cellText.includes('הכנסה מזכה') && cellText.includes('מבוטחת לא מעבודה')) {
                const nextRow = rows[rowIndex + 1];
                if (nextRow) {
                    const nextCells = nextRow.querySelectorAll('th, td');
                    if (nextCells[cellIndex]) {
                        const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                        if (!isNaN(value) && value > 0) {
                            result.shacharLoMeAvoda = value;
                            console.log('הכנסה לא מעבודה:', value);
                        }
                    }
                }
            }
            
            // הכנסה פנסיה הוני עד תקרה
            if (cellText === 'הכנסה פנסיה הוני עד תקרה') {
                const nextRow = rows[rowIndex + 1];
                if (nextRow) {
                    const nextCells = nextRow.querySelectorAll('th, td');
                    if (nextCells[cellIndex]) {
                        const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                        if (!isNaN(value) && value > 0) {
                            result.shacharMevutach += value;
                            console.log('✅ פנסיה הוני:', value);
                        }
                    }
                }
            }
            
            // הכנסה לקצבה לא מקיפה עד תקרה
                    if (cellText === 'הכנסה לקצבה לא מקיפה עד תקרה') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.shacharMevutach += value;
                                    console.log('✅ קצבה לא מקיפה:', value);
                                }
                            }
                        }
                    }
                    
                    // הכנסה לקצבה עד תקרה
                    if (cellText === 'הכנסה לקצבה עד תקרה (עד 2009 רק מקיפה)') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.shacharMevutach += value;
                                    console.log('✅ קצבה עד תקרה:', value);
                                }
                            }
                        }
                    }
                    
                    // ברוטו פנסיה תקציבית
                    if (cellText === 'ברוטו פנסיה תקציבית') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.shacharMevutach += value;
                                    console.log('✅ פנסיה תקציבית:', value);
                                }
                            }
                        }
                    }
        });
    });
}


        // 3. חילוץ נתונים מכל הטבלאות
        const allTables = doc.querySelectorAll('table');
        console.log('סה"כ טבלאות בקובץ:', allTables.length);
        
        allTables.forEach((table, tableIndex) => {
            const rows = table.querySelectorAll('tr');
            
            rows.forEach((row, rowIndex) => {
                const cells = row.querySelectorAll('th, td');
                
                // עבור על כל תא ובדוק את התוכן
                cells.forEach((cell, cellIndex) => {
                    const cellText = cell.textContent.trim();
                      
                    // חסכון ביטוח חיים
                    if (cellText === 'חסכון בטוח חיים') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.bituachChayim = value;
                                    console.log('✅ ביטוח חיים:', value);
                                }
                            }
                        }
                    }
                    
                    // חסכון פנסיה הוני- שכיר
                    if (cellText === 'חסכון פנסיה הוני- שכיר') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.havkadotPensia += value;
                                    console.log('✅ פנסיה הוני שכיר:', value);
                                }
                            }
                        }
                    }
                    
                    // חסכון קצבה לא מקיפה - שכיר
                    if (cellText === 'חסכון קצבה לא מקיפה - שכיר') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.havkadotPensia += value;
                                    console.log('✅ קצבה לא מקיפה שכיר:', value);
                                }
                            }
                        }
                    }
                    
                    // חסכון לקצבה מקיפה- שכיר
                    if (cellText === 'חסכון לקצבה מקיפה- שכיר') {
                        const nextRow = rows[rowIndex + 1];
                        if (nextRow) {
                            const nextCells = nextRow.querySelectorAll('th, td');
                            if (nextCells[cellIndex]) {
                                const value = parseFloat(nextCells[cellIndex].textContent.trim().replace(/,/g, ''));
                                if (!isNaN(value) && value > 0) {
                                    result.havkadotPensia += value;
                                    console.log('✅ קצבה מקיפה שכיר:', value);
                                }
                            }
                        }
                    }
                });
            });
        });

        console.log('=== תוצאות סופיות ===');
        console.log('שכר מבוטח:', result.shacharMevutach);
        console.log('שכר לא מבוטח:', result.shacharLoMevutach);
        console.log('הפקדות פנסיה:', result.havkadotPensia);
        console.log('ביטוח חיים:', result.bituachChayim);
        console.log('חודשים:', result.months);
        console.log('חודשים:', result.shacharLoMeAvoda);

        // בדיקה שנמצא לפחות חלק מהנתונים
        if (result.shacharMevutach > 0 || result.shacharLoMevutach > 0 || result.havkadotPensia > 0) {
            result.success = true;
        } else {
            result.error = 'לא נמצאו נתונים בקובץ ה-HTML. ייתכן שמבנה הקובץ שונה מהצפוי.';
        }

        return result;
        
    } catch (error) {
        console.error('שגיאה בפרסור:', error);
        return {
            success: false,
            error: 'שגיאה בפרסור הקובץ: ' + error.message
        };
    }
}
function findTableAfterH3(doc, title) {
    const headers = doc.querySelectorAll('h3');
    for (let header of headers) {
        if (header.textContent.includes(title)) {
            let nextElement = header.nextElementSibling;
            while (nextElement) {
                if (nextElement.tagName === 'DIV' && nextElement.classList.contains('table-block')) {
                    return nextElement.querySelector('table');
                }
                if (nextElement.tagName === 'TABLE') {
                    return nextElement;
                }
                if (nextElement.tagName === 'H1' || nextElement.tagName === 'H3') {
                    break;
                }
                nextElement = nextElement.nextElementSibling;
            }
        }
    }
    return null;
}
function findTableByPartialTitle(doc, headerTag, keywords) {
    const headers = doc.querySelectorAll(headerTag);
    for (let header of headers) {
        const headerText = header.textContent;
        const matchesAny = keywords.some(keyword => headerText.includes(keyword));
        
        if (matchesAny) {
            let nextElement = header.nextElementSibling;
            while (nextElement) {
                if (nextElement.tagName === 'DIV' && nextElement.classList.contains('table-block')) {
                    return nextElement.querySelector('table');
                }
                if (nextElement.tagName === 'TABLE') {
                    return nextElement;
                }
                if (nextElement.tagName === 'H1' || nextElement.tagName === 'H3') {
                    break;
                }
                nextElement = nextElement.nextElementSibling;
            }
        }
    }
    return null;
}

function fillFormFields(data) {
    if (data.shacharMevutach > 0) {
        document.getElementById('shacharMevutach').value = Math.round(data.shacharMevutach);
    }
    if (data.shacharLoMevutach > 0) {
        document.getElementById('shacharLoMevutach').value = Math.round(data.shacharLoMevutach);
    }
    if (data.months > 0) {
        document.getElementById('months').value = data.months;
    }
    if (data.havkadotPensia > 0) {
        document.getElementById('havkadotPensia').value = Math.round(data.havkadotPensia);
    }
    if (data.bituachChayim > 0) {
        document.getElementById('bituachChayim').value = Math.round(data.bituachChayim);
    }
    if (data.shacharLoMeAvoda > 0) {
        document.getElementById('shacharLoMeAvoda').value = Math.round(data.shacharLoMeAvoda);
    }
}
        // ============= תקרות לשנת 2025 - ניתן לעדכן כל שנה =============
        const TAKROT_2025 = {
            //תקרת הסכום לזיכוי בעד דמי ביטוח  ותגגמולים 45 א (ד)
            tikraLeZukui1 :189,
            // תקרת הסכום לזיכוי בעד דמי ביטוח ותגמולים 45 א (ה) (2)
            tikraLeZukui1 :19400,
            //הכנסה מזכה לפי סעיף 47(א)(1)
            hachnasaMezaka :9700,
            //הכנסה מזכה לפי סעיף 47(א)(2)
            hachnasaMezaka2 :13700,
            // סף עמית מוטב שנתי (16% מהשכר הממוצע במשק)
            amitMutavShanati: 25566.72,
            
            // תקרת שכר מבוטח חודשי לזכאות לסעיף 47 (ניכוי)
            shacharMevutachMaxLeSe47: 24250,
            
            // תקרת זיכוי מקסימלית לעמית מוטב
            zikuiMaxAmitMutav: 11640,
            
            // תקרת זיכוי מקסימלית לעמית לא מוטב
            zikuiMaxLoMutav: 16440,
            
            // תקרת ניכוי מקסימלית
            nikuiMax: 25608,
            
            // שיעור זיכוי
            zikuiRate: 0.35,
            
            // שיעור ניכוי רגיל
            nikuiRateNormal: 0.11,
            
            // שיעור ניכוי מעל גיל 50
            nikuiRateAge50: 0.165,
            
            // הכנסה מזכה לסעיף 47
            haknasaMezakeSe47: 116400
        };

        function formatNumber(num) {
            return num.toLocaleString('he-IL', {minimumFractionDigits: 0, maximumFractionDigits: 0});
        }

        function calculate() {
            // קריאת ערכים
            const shacharMevutach = parseFloat(document.getElementById('shacharMevutach').value) || 0;
            const shacharLoMeAvoda = parseFloat(document.getElementById('shacharLoMeAvoda').value) || 0;
            const shacharLoMevutach = parseFloat(document.getElementById('shacharLoMevutach').value) || 0;
            const months = parseInt(document.getElementById('months').value) || 12;
            const havkadotPensia = parseFloat(document.getElementById('havkadotPensia').value) || 0;
            const havkadotBituachChayim = parseFloat(document.getElementById('bituachChayim').value) || 0;
           // const havkadotKayamot = havkadotPensia + havkadotBituachChayim;
            const age = parseInt(document.getElementById('age').value) || 0;
             
   // חישובים
            const shacharMevutachChodshi = shacharMevutach / months;
            const amitMutavYachasi = (TAKROT_2025.amitMutavShanati / 12) * months;
            const isAmitMutav = havkadotPensia >= amitMutavYachasi;
            const missingToAmitMutav = Math.max(0, amitMutavYachasi - havkadotPensia);
            const hachnasaMezaka=TAKROT_2025.hachnasaMezaka;
            const hachnasaMezakaShnati = TAKROT_2025.hachnasaMezaka * months;
            const hachnasaMezaka2=TAKROT_2025.hachnasaMezaka2;
           
// ========== חישוב זיכוי סעיף 45א ==========

// 1. ביטוח חיים - זיכוי על מה שכבר הפקיד
const bituachChayimShalem = havkadotBituachChayim;
const zikuiBituachChayim = havkadotBituachChayim * 0.25;

// 2. פנסיה מהכנסה מבוטחת - זיכוי על מה שכבר הפקיד
let pensiaMevutachet = shacharMevutach;
let takratPensiaMevutachet = 0;
let sumMazke_PensiaMevutachet = 0;
let zikuiPensiaMevutachet = 0;

if (shacharMevutach > 0) {
    takratPensiaMevutachet =     hachnasaMezakaShnati * 0.07; 

    sumMazke_PensiaMevutachet = Math.min(pensiaMevutachet, takratPensiaMevutachet);
    zikuiPensiaMevutachet = sumMazke_PensiaMevutachet * 0.35;
}

// 3. הכנסה לא מבוטחת - הפקדה פוטנציאלית
let takratPensiaLoMevutachet = 0;
let takratPensiaLoMevutachetBasis = 0;
let zikuiPotencialiLoMevutach = 0;
let takratMaksimalit =0;
            

if (shacharLoMevutach > 0) {
    if (isAmitMutav) {
        // עמית מוטב - חשב תקרה זמינה
        const takra5Percent = shacharLoMevutach * 0.05;
        const takraMax = TAKROT_2025.hachnasaMezaka * 2 * months; 
        const nikui = Math.min(TAKROT_2025.hachnasaMezaka * months, shacharMevutach);
        const takratMaksimalit = (takraMax - nikui)*0.05;
        
        takratPensiaLoMevutachet = Math.max(0,Math.min(takra5Percent, takratMaksimalit)-havkadotBituachChayim);
       zikuiPotencialiLoMevutach = takratPensiaLoMevutachet * 0.35;
       takratPensiaLoMevutachetBasis =takratPensiaLoMevutachet/0.05
    } else {
        // לא עמית מוטב - חשב כמה חסר + תקרה אם יהפוך
        takratPensiaLoMevutachet = missingToAmitMutav; // כמה חסר להפוך לעמית מוטב
        
        // אם יהפוך לעמית מוטב, יוכל להפקיד:
         const takra5Percent = shacharLoMevutach * 0.05;
        const takraMax = TAKROT_2025.hachnasaMezaka * 2 * months; 
        const nikui = Math.min(TAKROT_2025.hachnasaMezaka * months, shacharMevutach);
        const takratMaksimalit = (takraMax - nikui)*0.05;
        
        takratPensiaLoMevutachet = Math.max(0,Math.min(takra5Percent, takratMaksimalit)-havkadotBituachChayim);
        zikuiPotencialiLoMevutach = takratPensiaLoMevutachet * 0.35;
        takratPensiaLoMevutachetBasis =takratPensiaLoMevutachet/0.05
   }
}

// 4. סה"כ זיכוי על מה שכבר הפקיד
const totalZikui45a = zikuiBituachChayim + zikuiPensiaMevutachet+zikuiPotencialiLoMevutach;

 // 5.זיכוי בגין הכנסה לא מעבודה
const takratshacharLoMeAvoda =  hachnasaMezaka2*months;         
let shacharLoMeAvodaBefoal=shacharLoMeAvoda;            
let zikuishacharLoMeAvoda = 0;

if (shacharLoMeAvoda > 0) {
    takratshacharLoMeAvoda =Math.min(shacharLoMeAvodaBefoal,takratshacharLoMeAvoda);
    zikuishacharLoMeAvoda = takratshacharLoMeAvoda * 0.35*0.05;
}


// 6. זיכוי פוטנציאלי נוסף
//const zikuiPotenciali = zikuiPotencialiLoMevutach;
            
            // בדיקת זכאות לסעיף 47 (ניכוי)
            const zikaiLeSe47 = shacharMevutachChodshi <= TAKROT_2025.shacharMevutachMaxLeSe47;

            // חישוב זיכוי
            const maxZikuiTakra = isAmitMutav ? TAKROT_2025.zikuiMaxAmitMutav : TAKROT_2025.zikuiMaxLoMutav;
            const zikui5Percent = shacharLoMevutach * 0.05;
            const zikuiFinal = Math.min(zikui5Percent, maxZikuiTakra);
            const zikuiTaxBenefit = zikuiFinal * TAKROT_2025.zikuiRate;

            // חישוב ניכוי (אם זכאי)
            let nikuiFinal = 0;
            let nikuiTaxBenefit47 = 0;
            let nikuiTaxBenefit35 = 0;
            
            if (zikaiLeSe47) {
                const nikuiRate = age >= 50 ? TAKROT_2025.nikuiRateAge50 : TAKROT_2025.nikuiRateNormal;
                const nikuiPercent = shacharLoMevutach * nikuiRate;
                nikuiFinal = Math.min(nikuiPercent, TAKROT_2025.nikuiMax);
                nikuiTaxBenefit47 = nikuiFinal * 0.47;
                nikuiTaxBenefit35 = nikuiFinal * 0.35;
            }
displayResults({
    shacharMevutach,
    shacharLoMevutach,
    shacharMevutachChodshi,
    months,
    age,
    havkadotPensia,
    havkadotBituachChayim,
    isAmitMutav,
    amitMutavYachasi,
    missingToAmitMutav,
    zikaiLeSe47,
    zikuiFinal,
    zikuiTaxBenefit,
    nikuiFinal,
    nikuiTaxBenefit47,
    nikuiTaxBenefit35,
    bituachChayimShalem,
    zikuiBituachChayim,
    pensiaMevutachet,
    takratPensiaMevutachet,
    sumMazke_PensiaMevutachet,
    zikuiPensiaMevutachet,
    shacharLoMevutach,
    takratMaksimalit,
    takratPensiaLoMevutachet,
    zikuiPotencialiLoMevutach,
    totalZikui45a,
    shacharLoMeAvoda,
    shacharLoMeAvodaBefoal,
    takratshacharLoMeAvoda,
    zikuishacharLoMeAvoda,
    takratPensiaLoMevutachetBasis
});
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('results');
            
            let html = '<div class="result-box highlight">';
            html += '<div class="result-title">📊 סיכום מצבך</div>';
            html += `<div class="result-item">
                <span class="result-label">שכר ברוטו מבוטח (חודשי)</span>
                <span class="result-value">${formatNumber(data.shacharMevutachChodshi)} ₪</span>
            </div>`;
            html += `<div class="result-item">
                <span class="result-label">שכר לא מבוטח (שנתי)</span>
                <span class="result-value">${formatNumber(data.shacharLoMevutach)} ₪</span>
            </div>`;
            html += `<div class="result-item">
                <span class="result-label">מספר חודשים</span>
                <span class="result-value">${data.months}</span>
            </div>`;
            html += `<div class="result-item">
                <span class="result-label">גיל</span>
                <span class="result-value">${data.age}</span>
            </div>`;
            html += '</div>';
         html += `<div class="result-item">
                <span class="result-label">הכנסה לא מעבודה (שנתי)</span>
                <span class="result-value">${formatNumber(data.shacharLoMeAvoda)} ₪</span>
            </div>`;    

            // בדיקת עמית מוטב
            html += '<div class="result-box">';
            html += '<div class="result-title">🔍 בדיקה #1: עמית מוטב</div>';
            html += `<div class="result-item">
                <span class="result-label">סף עמית מוטב (${data.months} חודשים)</span>
                <span class="result-value">${formatNumber(data.amitMutavYachasi)} ₪</span>
            </div>`;
            html += `<div class="result-item">
                <span class="result-label">הפקדות קיימות שלך</span>
                <span class="result-value">${formatNumber(data.havkadotPensia)} ₪</span>
            </div>`;
            
            if (data.isAmitMutav) {
                html += `<div class="result-item">
                    <span class="result-label">סטטוס</span>
                    <span class="result-value success">✅ עמית מוטב</span>
                </div>`;
                html += '<div class="explanation">';
                html += '<div class="explanation-title">💡 מה זה אומר?</div>';
                html += '<div class="explanation-text">את/ה עמית/ה מוטב/ת! זה אומר שאת/ה זכאי/ת לתקרות גבוהות יותר של הטבות מס. המשך לקרוא למטה כדי לראות את ההטבות המלאות.</div>';
                html += '</div>';
            } else {
                html += `<div class="result-item">
                    <span class="result-label">סטטוס</span>
                    <span class="result-value danger">❌ לא עמית מוטב</span>
                </div>`;
                html += `<div class="result-item">
                    <span class="result-label">חסר להשלמה</span>
                    <span class="result-value danger">${formatNumber(data.missingToAmitMutav)} ₪</span>
                </div>`;
                html += '<div class="warning-box">';
                html += '<div class="warning-title">⚠️ חשוב!</div>';
                html += `<div class="warning-text">כדי להפוך לעמית/ה מוטב/ת, עליך להפקיד עוד <strong>${formatNumber(data.missingToAmitMutav)} ₪</strong>. זה יאפשר לך לקבל הטבות מס גבוהות יותר.</div>`;
                html += '</div>';
            }
            html += '</div>';
            // הטבות זיכוי סעיף 45א
html += '<div class="result-box highlight">';
html += '<div class="result-title">💰 זיכוי ממס לפי סעיף 45א</div>';

// חלק 1: ביטוח חיים
html += '<div class="result-title" style="font-size: 16px; margin-top: 15px;">📋 זיכוי בעד ביטוח חיים - סעיף 45א(א)</div>';
html += `<div class="result-item">
    <span class="result-label">סכום ששולם לביטוח חיים</span>
    <span class="result-value">${formatNumber(data.bituachChayimShalem)} ₪</span>
</div>`;
html += `<div class="result-item">
    <span class="result-label">שיעור זיכוי</span>
    <span class="result-value">25%</span>
</div>`;
html += `<div class="result-item" style="background: #e8f5e9;">
    <span class="result-label" style="font-weight: bold;">💚 זיכוי ממס - ביטוח חיים</span>
    <span class="result-value success">${formatNumber(data.zikuiBituachChayim)} ₪</span>
</div>`;

// חלק 2: פנסיה - הכנסה מבוטחת
if (data.shacharMevutach > 0) {
    html += '<div class="result-title" style="font-size: 16px; margin-top: 20px;">📋זיכוי בגין הכנסת עבודה מבוטחת 45א</div>';
    html += `<div class="result-item">
        <span class="result-label">סכום ששולם לפנסיה (מההכנסה המבוטחת)</span>
        <span class="result-value">${formatNumber(data.pensiaMevutachet)} ₪</span>
    </div>`;
    html += `<div class="result-item">
        <span class="result-label">תקרה (7% מההכנסה המזכה המבוטחת)</span>
        <span class="result-value">${formatNumber(data.takratPensiaMevutachet)} ₪</span>
    </div>`;
    html += `<div class="result-item">
        <span class="result-label">סכום המזכה בפועל</span>
        <span class="result-value">${formatNumber(data.sumMazke_PensiaMevutachet)} ₪</span>
    </div>`;
    html += `<div class="result-item">
        <span class="result-label">שיעור זיכוי</span>
        <span class="result-value">35%</span>
    </div>`;
    html += `<div class="result-item" style="background: #e8f5e9;">
        <span class="result-label" style="font-weight: bold;">💚 זיכוי ממס - פנסיה מהכנסה מבוטחת</span>
        <span class="result-value success">${formatNumber(data.zikuiPensiaMevutachet)} ₪</span>
    </div>`;
}

// חלק 3: פנסיה - הכנסה לא מבוטחת
if (data.shacharLoMevutach > 0) {
    html += '<div class="result-title" style="font-size: 16px; margin-top: 20px;">📋 זיכוי בגין הכנסת עבודה לא מבוטחת - סעיף 45א(ה)(2)(ב)</div>';
    
    if (!data.isAmitMutav) {
        // אם לא עמית מוטב - הודעת אזהרה
        html += '<div class="warning-box" style="margin-bottom: 15px;">';
        html += '<div class="warning-title">⚠️ שים לב</div>';
        html += '<div class="warning-text">';
        html += '<strong>הטבת המס בגין הכנסה לא מבוטחת מגיעה רק לעמית מוטב!</strong><br><br>';
        html += `תוכל ליהנות מהטבת מס זו רק בתנאי שתפקיד מינימום של <strong>${formatNumber(data.missingToAmitMutav)} ₪</strong> לקופת פנסיה, `;
        html += 'ובכך תהפוך לעמית מוטב.<br><br>';
        html += 'לאחר שתהפוך לעמית מוטב, תוכל ליהנות מהזיכוי המפורט להלן:';
        html += '</div>';
        html += '</div>';
    }
    
    html += `<div class="result-item">
        <span class="result-label">הכנסה לא מבוטחת</span>
        <span class="result-value">${formatNumber(data.shacharLoMevutach)} ₪</span>
    </div>`;
    html += `<div class="result-item">
        <span class="result-label">תקרת הכנסה לא מבוטחת</span>
        <span class="result-value">${formatNumber(data.takratPensiaLoMevutachetBasis)} ₪</span>
    </div>`;
    html += `<div class="result-item">
        <span class="result-label">תקרת זיכוי: 5% מהכנסה לא מבוטחת (מוגבל בתקרה)</span>
        <span class="result-value">${formatNumber(data.takratPensiaLoMevutachet)} ₪</span>
    </div>`;
    
    html += `<div class="result-item">
        <span class="result-label">שיעור זיכוי</span>
        <span class="result-value">35%</span>
    </div>`;
    
    html += `<div class="result-item" style="background: ${data.isAmitMutav ? '#e8f5e9' : '#fff3e0'};">
        <span class="result-label" style="font-weight: bold;">${data.isAmitMutav ? '💚' : '⚠️'} זיכוי ממס פוטנציאלי - בגין הכנסה לא מבוטחת</span>
        <span class="result-value ${data.isAmitMutav ? 'success' : ''}">${formatNumber(data.zikuiPotencialiLoMevutach)} ₪</span>
    </div>`;      
}
            // חלק 5 זיכוי בגין שכר לא מעבודה 
if (data.shacharLoMeAvoda > 0) {
    html += '<div class="result-title" style="font-size: 16px; margin-top: 20px;">📋זיכוי בגין הכנסה לא מעבודה 45א</div>';
    html += `<div class="result-item">
        <span class="result-label">הכנסה לא מעבודה </span>
        <span class="result-value">${formatNumber(data.shacharLoMeAvodaBefoal)} ₪</span>
    </div>`;
    html += `<div class="result-item">
        <span class="result-label">תקרת שכר לא מעבודה סעיף 47א2 </span>
        <span class="result-value">${formatNumber(data.takratshacharLoMeAvoda)} ₪</span>
    </div>`;
      html += `<div class="result-item">
        <span class="result-label">שיעור זיכוי</span>
        <span class="result-value">35%</span>
    </div>`;
    html += `<div class="result-item" style="background: #e8f5e9;">
        <span class="result-label" style="font-weight: bold;">זיכוי בגין תקרת הכנסה לא מעבודה כפול 5%</span>
        <span class="result-value success">${formatNumber(data.zikuishacharLoMeAvoda)} ₪</span>
    </div>`;
}
// סיכום כולל
html += `<div class="big-number" style="background: linear-gradient(135deg, #28a74515 0%, #20c99715 100%); color: #28a745; margin-top: 20px;">
   ✅ סה"כ זיכוי ממס (סעיף 45א): ${formatNumber(data.totalZikui45a)} ₪
</div>`;

html += '</div>';

            // בדיקת זכאות לניכוי
            html += '<div class="result-box">';
            html += '<div class="result-title">🔍 בדיקה #2: זכאות לניכוי (סעיף 47)</div>';
            html += `<div class="result-item">
                <span class="result-label">שכר מבוטח חודשי שלך</span>
                <span class="result-value">${formatNumber(data.shacharMevutachChodshi)} ₪</span>
            </div>`;
            html += `<div class="result-item">
                <span class="result-label">הכנסה מזכה לפי סעיף 47 (א)(1)</span>
                <span class="result-value">${formatNumber(TAKROT_2025.hachnasaMezaka)} ₪</span>
            </div>`;
            html += `<div class="result-item">
                <span class="result-label">סכום השווה לשתי פעמים וחצי הסכום האמור בפסקה (1) להגדרה "הכנסה מזכה" לשנה -תקרת שכר לסעיף 47</span>
                <span class="result-value">${formatNumber(TAKROT_2025.shacharMevutachMaxLeSe47)} ₪</span>
            </div>`;
            
            if (data.zikaiLeSe47) {
                html += `<div class="result-item">
                    <span class="result-label">זכאות לניכוי</span>
                    <span class="result-value success">✅ כן</span>
                </div>`;
                html += '<div class="info-box">';
                html += '<div class="info-box-title">💡 מה זה אומר?</div>';
                html += '<div class="info-box-text">את/ה זכאי/ת גם לניכוי וגם לזיכוי! זה אומר שאת/ה יכול/ה לקבל הטבות מס גם על ניכוי (שמפחית את ההכנסה החייבת במס) וגם על זיכוי (הנחה ישירה במס).</div>';
                html += '</div>';
            } else {
                html += `<div class="result-item">
                    <span class="result-label">זכאות לניכוי</span>
                    <span class="result-value danger">❌ לא</span>
                </div>`;
                html += '<div class="warning-box">';
                html += '<div class="warning-title">⚠️ שים/י לב</div>';
                html += `<div class="warning-text">השכר המבוטח שלך עובר את התקרה (${formatNumber(TAKROT_2025.shacharMevutachMaxLeSe47)} ₪), לכן את/ה זכאי/ת <strong>רק לזיכוי</strong> ולא לניכוי.</div>`;
                html += '</div>';
            }
            html += '</div>';

            // הטבות ניכוי (אם זכאי)
            if (data.zikaiLeSe47 && data.nikuiFinal > 0) {
                html += '<div class="result-box highlight">';
                html += '<div class="result-title">💰 הטבת ניכוי (סעיף 47)</div>';
                
                const nikuiRate = data.age >= 50 ? TAKROT_2025.nikuiRateAge50 : TAKROT_2025.nikuiRateNormal;
                html += `<div class="result-item">
                    <span class="result-label">שיעור ניכוי ${data.age >= 50 ? '(גיל 50+)' : ''}</span>
                    <span class="result-value">${(nikuiRate * 100)}%</span>
                </div>`;
                html += `<div class="result-item">
                    <span class="result-label">${(nikuiRate * 100)}% מהשכר הלא מבוטח</span>
                    <span class="result-value">${formatNumber(data.shacharLoMevutach * nikuiRate)} ₪</span>
                </div>`;
                html += `<div class="big-number">הפקדה מקסימלית: ${formatNumber(data.nikuiFinal)} ₪</div>`;
                html += `<div class="result-item">
                    <span class="result-label">חיסכון במס (מדרגת 47%)</span>
                    <span class="result-value success">${formatNumber(data.nikuiTaxBenefit47)} ₪</span>
                </div>`;
                html += `<div class="result-item">
                    <span class="result-label">חיסכון במס (מדרגת 35%)</span>
                    <span class="result-value success">${formatNumber(data.nikuiTaxBenefit35)} ₪</span>
                </div>`;
                
                html += '<div class="explanation">';
                html += '<div class="explanation-title">💡 מה זה ניכוי?</div>';
                html += '<div class="explanation-text">';
                html += '<strong>ניכוי = הורדת ההכנסה החייבת במס.</strong><br><br>';
                html += `אם תפקיד/י <strong>${formatNumber(data.nikuiFinal)} ₪</strong>, ההכנסה שעליה מחשבים את המס תפחת בסכום הזה.<br><br>`;
                html += 'החיסכון במס תלוי במדרגת המס שלך:<br>';
                html += '• אם את/ה במדרגת 47%: חוסך/ת ' + formatNumber(data.nikuiTaxBenefit47) + ' ₪<br>';
                html += '• אם את/ה במדרגת 35%: חוסך/ת ' + formatNumber(data.nikuiTaxBenefit35) + ' ₪';
                html += '</div>';
                html += '</div>';
                html += '</div>';
            }

            // הסברים נוספים
            html += '<div class="result-box">';
            html += '<div class="result-title">📚 הסברים חשובים</div>';
            
            html += '<div class="explanation" style="background: #e8f5e9; border-color: #4caf50;">';
            html += '<div class="explanation-title" style="color: #2e7d32;">✅ מה זה שכר לא מבוטח?</div>';
            html += '<div class="explanation-text" style="color: #2e7d32;">';
            html += 'שכר לא מבוטח הוא החלק מהשכר שעבורו המעסיק <strong>לא</strong> מפריש לפנסיה, כמו:<br>';
            html += '• בונוסים ותוספות<br>';
            html += '• דמי הבראה<br>';
            html += '• הוצאות נסיעה<br>';
            html += '• שעות נוספות<br>';
            html += '• שי לחג<br>';
            html += 'על הסכומים האלה אפשר להפקיד בעצמך ולקבל הטבות מס!';
            html += '</div>';
            html += '</div>';

            html += '<div class="explanation" style="background: #fff3e0; border-color: #ff9800; margin-top: 15px;">';
            html += '<div class="explanation-title" style="color: #e65100;">⚖️ הבדל בין זיכוי לניכוי</div>';
            html += '<div class="explanation-text" style="color: #e65100;">';
            html += '<strong>זיכוי (סעיף 45א):</strong><br>';
            html += '• הנחה ישירה מהמס<br>';
            html += '• תמיד 35% מסכום ההפקדה<br>';
            html += '• לא תלוי במדרגת המס<br><br>';
            html += '<strong>ניכוי (סעיף 47):</strong><br>';
            html += '• מפחית את ההכנסה החייבת במס<br>';
            html += '• החיסכון תלוי במדרגת המס שלך<br>';
            html += '• רק למי ששכרו המבוטח נמוך מ-' + formatNumber(TAKROT_2025.shacharMevutachMaxLeSe47) + ' ₪ לחודש';
            html += '</div>';
            html += '</div>';

            html += '<div class="explanation" style="background: #e3f2fd; border-color: #2196f3; margin-top: 15px;">';
            html += '<div class="explanation-title" style="color: #0d47a1;">🎓 מה זה עמית מוטב?</div>';
            html += '<div class="explanation-text" style="color: #0d47a1;">';
       html += '<strong>הגדרה לפי סעיף 47(א)(7) לפקודת מס הכנסה:</strong><br>';
html += '"עמית מוטב" – יחיד שהפקיד בשנת המס לפנסיה לפחות ';
html += '<strong>16% מהשכר הממוצע במשק</strong>.<br><br>';

html += '<strong>חישוב לשנת 2025:</strong><br>';
html += '• השכר הממוצע במשק: 13,316 ₪/חודש (159,792 ₪/שנה)<br>';
html += '• 16% מהשכר הממוצע: 159,792 × 16% = <strong>' + formatNumber(TAKROT_2025.amitMutavShanati) + ' ₪</strong><br><br>';

html += '<strong>💡 לתקופות עבודה חלקיות:</strong><br>';
html += 'הסכום מחושב יחסי למספר חודשי העבודה.<br>';
html += 'לדוגמה:<br>';
html += '• 12 חודשים → ' + formatNumber(TAKROT_2025.amitMutavShanati) + ' ₪<br>';
html += '• 9 חודשים → ' + formatNumber((TAKROT_2025.amitMutavShanati / 12) * 9) + ' ₪<br>';
html += '• 6 חודשים → ' + formatNumber((TAKROT_2025.amitMutavShanati / 12) * 6) + ' ₪<br><br>';
html += '</div>';
html += '</div>';

            if (data.age >= 50) {
                html += '<div class="explanation" style="background: #f3e5f5; border-color: #9c27b0; margin-top: 15px;">';
                html += '<div class="explanation-title" style="color: #6a1b9a;">🎂 הטבה מיוחדת לגיל 50+</div>';
                html += '<div class="explanation-text" style="color: #6a1b9a;">';
                html += 'כיוון שאת/ה מעל גיל 50, את/ה זכאי/ת לשיעור ניכוי מוגדל!<br><br>';
                html += '• עד גיל 50: 11% ניכוי<br>';
                html += '• מעל גיל 50: <strong>16.5%</strong> ניכוי (תוספת של 50%)<br><br>';
                html += '⚠️ <strong>אבל שים/י לב:</strong> ההטבה הזו רלוונטית רק אם השכר המבוטח שלך נמוך מ-' + formatNumber(TAKROT_2025.shacharMevutachMaxLeSe47) + ' ₪ לחודש.';
                html += '</div>';
                html += '</div>';
            }

            // אזור עדכון תקרות
            html += '<div class="result-box" style="background: #f5f5f5; border: 2px dashed #999;">';
            html += '<div class="result-title" style="color: #666;">⚙️ תקרות שנת 2025 (לעדכון)</div>';
            html += '<div style="font-size: 13px; color: #666; line-height: 1.8;">';
         html += '<strong>📌 סף עמית מוטב (סעיף 47(א)(7)):</strong><br>';
html += '&nbsp;&nbsp;&nbsp;' + formatNumber(TAKROT_2025.amitMutavShanati) + ' ₪/שנה (16% מהשכר הממוצע במשק)<br>';
html += '&nbsp;&nbsp;&nbsp;מקור: השכר הממוצע: 13,316 ₪ × 12 × 16%<br><br>';
            html += '📌 <strong>הכנסה מזכה לפי סעיף 47 (א)(1)</strong> '+formatNumber(TAKROT_2025.hachnasaMezaka) + ' ₪/חודש<br>';
            html += '📌 <strong>סכום השווה לשתי פעמים וחצי הסכום האמור בפסקה (1) להגדרה "הכנסה מזכה" לשנה -תקרת הכנסה לניכוי לפי סעיף 47:</strong> ' + formatNumber(TAKROT_2025.shacharMevutachMaxLeSe47) + ' ₪/חודש<br>';
            html += '📌 <strong>לענין עמית מוטב שלא היתה לו בשנת המס הכנסה מבוטחת – 5% מהכנסתו החייבת עד לסכום השווה לפעמיים הסכום האמור בפסקה (1) להגדרה "הכנסה מזכה" שבסעיף 47(א)(1) לשנה-תקרת זיכוי עמית מוטב:</strong> ' + formatNumber(TAKROT_2025.zikuiMaxAmitMutav) + ' ₪<br>';
            html += '📌 <strong>תקרת זיכוי לא עמית מוטב:</strong> ' + formatNumber(TAKROT_2025.zikuiMaxLoMutav) + ' ₪<br>';
            html += '📌 <strong>תקרת ניכוי מקסימלית:</strong> ' + formatNumber(TAKROT_2025.nikuiMax) + ' ₪<br>';
            html += '📌 <strong>הכנסה מזכה סעיף 47:</strong> ' + formatNumber(TAKROT_2025.haknasaMezakeSe47) + ' ₪<br><br>';
            
            html += '</div>';
            html += '</div>';

            // הצהרת אחריות
            html += '<div class="warning-box" style="margin-top: 30px;">';
            html += '<div class="warning-title">⚠️ הצהרת אחריות</div>';
            html += '<div class="warning-text">';
            html += 'מחשבון זה מספק אומדן כללי בלבד ואינו מהווה ייעוץ מס או פנסיוני. התוצאות מבוססות על פקודת מס הכנסה ותקנותיה הידועות לשנת 2025, אך:<br><br>';
            html += '• התקרות והסכומים עשויים להשתנות במהלך השנה<br>';
            html += '• מצבים אישיים מיוחדים עשויים להשפיע על החישוב<br>';
            html += '• מומלץ להתייעץ עם יועץ מס או יועץ פנסיוני מוסמך<br>';
            html += '• המידע נכון למועד יצירת המחשבון (2025)<br><br>';
            html += '<strong>אין לראות במידע זה תחליף לייעוץ מקצועי!</strong>';
            html += '</div>';
            html += '</div>';

            resultsDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
            
            // גלילה לתוצאות
            resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // הוספת פונקציונליות Enter
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        calculate();
                    }
                });
            });
        });
    </script>
</body>
</html>
